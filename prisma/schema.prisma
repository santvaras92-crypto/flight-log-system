generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                Int     @id @default(autoincrement())
  userId            Int
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  User              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Aircraft {
  matricula        String             @id
  modelo           String?
  hobbs_actual     Decimal            @default(0.0)
  tach_actual      Decimal            @default(0.0)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  Component        Component[]
  Flight           Flight[]
  FlightSubmission FlightSubmission[]
}

model Component {
  id                     Int       @id @default(autoincrement())
  tipo                   String
  horas_acumuladas       Decimal   @default(0.0)
  limite_tbo             Decimal
  aircraftId             String
  last_overhaul_airframe Decimal?
  last_overhaul_date     DateTime?
  overhaul_notes         String?
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  Aircraft               Aircraft  @relation(fields: [aircraftId], references: [matricula])
}

model Flight {
  id               Int               @id @default(autoincrement())
  submissionId     Int?              @unique
  fecha            DateTime          @default(now())
  hobbs_inicio     Decimal?
  hobbs_fin        Decimal?
  tach_inicio      Decimal?
  tach_fin         Decimal?
  diff_hobbs       Decimal?
  diff_tach        Decimal?
  costo            Decimal?
  pilotoId         Int?
  aircraftId       String
  copiloto         String?
  cliente          String?
  instructor       String?
  detalle          String?
  createdAt        DateTime          @default(now())
  airframe_hours   Decimal?
  engine_hours     Decimal?
  propeller_hours  Decimal?
  instructor_rate  Decimal?
  piloto_raw       String?
  tarifa           Decimal?
  aerodromoDestino String?
  aerodromoSalida  String?
  aprobado         Boolean           @default(false)
  Aircraft         Aircraft          @relation(fields: [aircraftId], references: [matricula])
  User             User?             @relation(fields: [pilotoId], references: [id])
  FlightSubmission FlightSubmission? @relation(fields: [submissionId], references: [id])
  Transaction      Transaction?
}

model FlightSubmission {
  id               Int        @id @default(autoincrement())
  pilotoId         Int
  aircraftId       String
  estado           String     @default("PENDIENTE")
  errorMessage     String?
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  cliente          String?
  copiloto         String?
  detalle          String?
  fechaVuelo       DateTime?
  hobbsFinal       Decimal?
  instructorRate   Decimal?
  notificado       Boolean    @default(false)
  rate             Decimal?
  tachFinal        Decimal?
  aerodromoDestino String?
  aerodromoSalida  String?
  Flight           Flight?
  Aircraft         Aircraft   @relation(fields: [aircraftId], references: [matricula])
  User             User       @relation(fields: [pilotoId], references: [id])
  ImageLog         ImageLog[]
}

model ImageLog {
  id               Int              @id @default(autoincrement())
  submissionId     Int
  tipo             String
  imageUrl         String
  valorExtraido    Decimal?
  confianza        Decimal?
  validadoManual   Boolean          @default(false)
  createdAt        DateTime         @default(now())
  FlightSubmission FlightSubmission @relation(fields: [submissionId], references: [id])
}

model Session {
  id           Int      @id @default(autoincrement())
  sessionToken String   @unique
  userId       Int
  expires      DateTime
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Transaction {
  id        Int      @id @default(autoincrement())
  monto     Decimal
  tipo      String
  userId    Int
  flightId  Int?     @unique
  createdAt DateTime @default(now())
  Flight    Flight?  @relation(fields: [flightId], references: [id])
  User      User     @relation(fields: [userId], references: [id])
}

model User {
  id               Int                @id @default(autoincrement())
  nombre           String
  codigo           String?            @unique
  email            String?            @unique
  emailVerified    DateTime?
  rol              String
  saldo_cuenta     Decimal            @default(0.0)
  tarifa_hora      Decimal
  password         String
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  fechaNacimiento  DateTime?
  licencia         String?
  telefono         String?
  documento        String?
  tipoDocumento    String?
  resetToken       String?            @unique
  resetTokenExpiry DateTime?
  Account          Account[]
  Deposit          Deposit[]
  DeviceToken      DeviceToken[]
  Flight           Flight[]
  FlightSubmission FlightSubmission[]
  FuelLog          FuelLog[]
  Session          Session[]
  Transaction      Transaction[]
}

model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@unique([identifier, token])
}

model Deposit {
  id        Int      @id @default(autoincrement())
  userId    Int
  createdAt DateTime @default(now())
  detalle   String?
  fecha     DateTime @default(now())
  imageUrl  String?
  monto     Decimal
  estado    String   @default("PENDIENTE")
  User      User     @relation(fields: [userId], references: [id])
}

model FuelLog {
  id        Int      @id @default(autoincrement())
  userId    Int
  fecha     DateTime @default(now())
  litros    Decimal
  monto     Decimal
  imageUrl  String?
  detalle   String?
  createdAt DateTime @default(now())
  estado    String   @default("PENDIENTE")
  User      User     @relation(fields: [userId], references: [id])
}

model DeviceToken {
  id         Int      @id @default(autoincrement())
  userId     Int
  token      String   @unique
  deviceInfo String?
  createdAt  DateTime @default(now())
  lastUsed   DateTime @default(now())
  expiresAt  DateTime
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}
